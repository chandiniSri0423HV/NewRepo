pipeline {
    agent any

    stages {
        stage('Check if NEWINTEGRATION_NEWREPO_01.00.0000 is activated') {
            steps {
                script {		
					//Check activeStatus of NEWINTEGRATION_NEWREPO_01.00.0000
					bat '''
                    for /F "tokens=*" %%A in ('curl -X GET --header "Authorization: Basic ZGV2b3BzX3VzZXI6T2ljX0plbmtpbnMjMjAyMw==" --header "Accept:application/json" "https://testinstance-idevjxz332qf-ia.integration.ocp.oraclecloud.com/ic/api/integration/v1/integrations/NEWINTEGRATION_NEWREPO|01.00.0000/activationStatus"') do set status=%%A
                    '''
                    echo "Activation Status: %status%"

                    if ("%status%" == "Active") {
                        // Deactivate NEWINTEGRATION_NEWREPO_01.00.0000 if it is active
                    echo "NEWINTEGRATION_NEWREPO_01.00.0000 integration deactivated"

                        bat '''
                        curl -X POST --header "Authorization: Basic ZGV2b3BzX3VzZXI6T2ljX0plbmtpbnMjMjAyMw==" --header "Content-Type:application/json" --header "X-HTTP-Method-Override:PATCH" -d @C:/Docs/Git/NewRepo/Deactivate.json -d "enableAsyncActivationMode=true" "https://testinstance-idevjxz332qf-ia.integration.ocp.oraclecloud.com/ic/api/integration/v1/integrations/NEWINTEGRATION_NEWREPO|01.00.0000"
                        '''
                    } else {
                        echo "NEWINTEGRATION_NEWREPO_01.00.0000 integration is deactivated"
                    }
                }
            }
        }

        stage('Import NEWINTEGRATION_NEWREPO_01.00.0001') {
            steps {
				bat'''
                curl --location "https://testinstance-idevjxz332qf-ia.integration.ocp.oraclecloud.com/ic/api/integration/v1/integrations/archive" --header "Authorization: Basic cG9jdXNlcjpIVk9JQ01heSMyMDIz" --form "file=@"NEWINTEGRATION_NEWREPO_01.00.0001.iar"
                '''
				echo "NEWINTEGRATION_NEWREPO_01.00.0001 integration imported"
            }
        }

        stage('Activate NEWINTEGRATION_NEWREPO_01.00.0001') {
            steps {
			bat'''
            curl --header "Authorization: Basic ZGV2b3BzX3VzZXI6T2ljX0plbmtpbnMjMjAyMw==" --header "Content-Type:application/json" --header "X-HTTP-Method-Override:PATCH" -d @C:/Docs/Git/NewRepo/Activate.json --location "https://testinstance-idevjxz332qf-ia.integration.ocp.oraclecloud.com/ic/api/integration/v1/integrations/NEWINTEGRATION_NEWREPO|01.00.0001"
			'''
			echo "NEWINTEGRATION_NEWREPO_01.00.0001 integration activated"
            }
        }
    }
}
