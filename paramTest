pipeline
{
	agent any
	stages {
		stage('Deployement of an Integration'){
			steps{
				script{
				def URL=(params.IntegrationArchiveURL).toString()+"/ic/api/integration/v1/integrations/archive"
				def curlCommand = "curl --location \"${URL}\" --silent --header \"Authorization: ${params.AuthorizationBasic1}\" --form \"file=@\\\"${params.IntegrationFileName}\\\"\""
                bat(curlCommand)
				}
			}
		}
		

        stage('Configuring a connection') {
            steps {
			script{
				 bat """
                    curl --header "Authorization: ${params.AuthorizationBasic2}" --header "X-HTTP-Method-Override:PATCH" --header "Content-Type:application/json" -d @${params.RESTConnFileName} ${IntegrationArchiveURL}/ic/api/integration/v1/connections/${params.connectionName}
                    """
				}
			}
        }
		
		stage('Configuring a new lookup')
		{
		steps { 
		script{
				bat'''
				echo "${LookupFileName}"
				curl -X POST --header "Authorization: ${params.AuthorizationBasic2}" --form \"file=@\\\"${LookupFileName}\\\"\" --form type=application/octet-stream ${IntegrationArchiveURL}/ic/api/integration/v1/lookups/archive
				//curl -X POST --header "Authorization: Basic ZGV2b3BzX3VzZXI6T2ljX0plbmtpbnMjMjAyMw==" --form file=@PersonDetails.csv --form type=application/octet-stream https://testinstance-idevjxz332qf-ia.integration.ocp.oraclecloud.com/ic/api/integration/v1/lookups/archive

				'''
				}
			}
		}
		
		
		stage('Activation of the integration')
		{
		steps { 
		script{
				bat'''		
				curl --header "Authorization: Basic ZGV2b3BzX3VzZXI6T2ljX0plbmtpbnMjMjAyMw==" --header "Content-Type:application/json" --header "X-HTTP-Method-Override:PATCH" -d @Activate.json --location "https://testinstance-idevjxz332qf-ia.integration.ocp.oraclecloud.com/ic/api/integration/v1/integrations/NEWINTEGRATION_NEWREPO|01.00.0000"
				'''
				}
			}
		}
    }
}
